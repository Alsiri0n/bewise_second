Задача 2

Необходимо реализовать веб-сервис, выполняющий следующие функции:
1. Создание пользователя;
1. Для каждого пользователя - сохранение аудиозаписи в формате wav, преобразование её в формат mp3 и запись в базу данных и предоставление ссылки для скачивания аудиозаписи.

__Детализация задачи:__

1. С помощью Docker (предпочтительно - docker-compose) развернуть образ с любой опенсорсной СУБД (предпочтительно - PostgreSQL). Предоставить все необходимые скрипты и конфигурационные (docker/compose) файлы для развертывания СУБД, а также инструкции для подключения к ней. Необходимо обеспечить сохранность данных при рестарте контейнера (то есть - использовать volume-ы для хранения файлов СУБД на хост-машине.
1. Реализовать веб-сервис со следующими REST методами:
   1. Создание пользователя, POST:
      * Принимает на вход запросы с именем пользователя;
      * Создаёт в базе данных пользователя заданным именем, так же генерирует уникальный идентификатор пользователя и UUID токен доступа (в виде строки) для данного пользователя;
      * Возвращает сгенерированные идентификатор пользователя и токен.
   1. Добавление аудиозаписи, POST:
      * Принимает на вход запросы, содержащие уникальный идентификатор пользователя, токен доступа и аудиозапись в формате wav;
      * Преобразует аудиозапись в формат mp3, генерирует для неё уникальный UUID идентификатор и сохраняет их в базе данных;
      * Возвращает URL для скачивания записи вида http://host:port/record?id=id_записи&user=id_пользователя.
   1. Доступ к аудиозаписи, GET:
      * Предоставляет возможность скачать аудиозапись по ссылке из п 2.2.3.
1. Для всех сервисов метода должна быть предусмотрена обработка различных ошибок, возникающих при выполнении запроса, с возвращением соответствующего HTTP статуса.
1. Модель данных (таблицы, поля) для каждого из заданий можно выбрать по своему усмотрению.
1. В репозитории с заданием должны быть предоставлены инструкции по сборке докер-образа с сервисами из пп. 2. и 3., их настройке и запуску. А также пример запросов к методам сервиса.
1. Желательно, если при выполнении задания вы будете использовать docker-compose, SQLAlchemy, пользоваться аннотацией типов.

Инструкция по сборке
1. Клонируем репозиторий.
1. Создаём файл .env с необходимыми параметрами (можно переименовать .env.example)
1. Создаем образ ```docker-compose -f ./docker-compose.yml build```
1. Далее запускаем ```docker-compose up```
1. Приложение в докере запускается на 8080 порту. 
1. Для проверки приложения можно использовать Postman, для этого необходимо отправить запрос вида ```127.0.0.1:8000/login``` с телом запроса в формате JSON ```{
     "username": "lorem_ipsum"
}```.
   
    В ответ придёт JSON в формате:
    ```
   {
        "uuid": "de08e2ce-f68b-11ed-a599-0242ac120003",
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2ODQ1NDk2MTAsImlhdCI6MTY4NDUzMTYxMCwic2NvcGUiOiJhY2Nlc3NfdG9rZW4iLCJkYXRhIjoiVGVzdCJ9.GxlRVVTZpFqLcIm2h0LDJWFNwOlGJOy8pUO8xMohDfI"
   }
   ```
1. После этого можно загружать звуковой файл. Также, необходимо добавить BearerToken, полученный на предыдущем шаге. Пример загрузки файла из Postman.
    ![alt text](config.png "Title")
    В ответ придёт JSON в формате:
    ```
   {
        "url": "http://127.0.0.1:8000/record?id=fc59c978-f68b-11ed-a599-0242ac120003&user=de08e2ce-f68b-11ed-a599-0242ac120003"
   }
   ```
1. Для скачивания файла необходио отправить GET-запрос на адрес, полученный на предыдущем шаге.


Работоспособность проверена на Python 3.11, FastAPI, SQLAlchemy 2, Alembic, asyncpg, uvicorn. Так же было использовано poetry, Jenkins, docker-compose.
Для перекодирования файлов из wav в mp3 в докере устанавливается ffmpeg.



